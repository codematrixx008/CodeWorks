public static string GenerateInsertUpdateProcSql_Separate(SQLTableModel tempTable, SQLTableModel permanentTable)
{
    var sb = new StringBuilder();

    string procName = $"InsertUpdate{permanentTable.TableName}Data";

    sb.AppendLine($"CREATE PROCEDURE {procName}");
    sb.AppendLine("AS");
    sb.AppendLine("BEGIN");
    sb.AppendLine("    SET NOCOUNT ON;");
    sb.AppendLine();

    sb.AppendLine($"    -- First Update existing records");
    sb.AppendLine($"    UPDATE P");
    sb.AppendLine($"    SET");

    var updateColumns = permanentTable.Columns
        .Where(c => !c.Equals(permanentTable.PrimaryKeyColumn, StringComparison.OrdinalIgnoreCase))
        .ToList();

    for (int i = 0; i < updateColumns.Count; i++)
    {
        string col = updateColumns[i];
        string comma = (i == updateColumns.Count - 1) ? "" : ",";
        sb.AppendLine($"        P.[{col}] = T.[{col}]{comma}");
    }

    sb.AppendLine($"    FROM [{permanentTable.TableName}] P");
    sb.AppendLine($"    INNER JOIN [{tempTable.TableName}] T");
    sb.AppendLine($"        ON P.[{permanentTable.PrimaryKeyColumn}] = T.[{tempTable.PrimaryKeyColumn}];");
    sb.AppendLine();

    sb.AppendLine($"    -- Then Insert new records");
    sb.AppendLine($"    INSERT INTO [{permanentTable.TableName}] (");

    for (int i = 0; i < permanentTable.Columns.Count; i++)
    {
        string col = permanentTable.Columns[i];
        string comma = (i == permanentTable.Columns.Count - 1) ? "" : ",";
        sb.AppendLine($"        [{col}]{comma}");
    }

    sb.AppendLine("    )");
    sb.AppendLine("    SELECT");

    for (int i = 0; i < permanentTable.Columns.Count; i++)
    {
        string col = permanentTable.Columns[i];
        string comma = (i == permanentTable.Columns.Count - 1) ? "" : ",";
        sb.AppendLine($"        T.[{col}]{comma}");
    }

    sb.AppendLine($"    FROM [{tempTable.TableName}] T");
    sb.AppendLine($"    WHERE NOT EXISTS (");
    sb.AppendLine($"        SELECT 1 FROM [{permanentTable.TableName}] P");
    sb.AppendLine($"        WHERE P.[{permanentTable.PrimaryKeyColumn}] = T.[{tempTable.PrimaryKeyColumn}]");
    sb.AppendLine("    );");
    sb.AppendLine();

    sb.AppendLine($"    -- Optional: Clear temporary table");
    sb.AppendLine($"    DELETE FROM [{tempTable.TableName}];");

    sb.AppendLine("END;");
    return sb.ToString();
}
